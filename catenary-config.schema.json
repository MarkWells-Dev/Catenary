{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Catenary Configuration",
  "type": "object",
  "properties": {
    "idle_timeout": {
      "type": "integer",
      "description": "Global idle timeout in seconds. LSP servers will be shut down if no documents are open for this duration.",
      "default": 300
    },
    "server": {
      "type": "object",
      "description": "Server definitions keyed by language ID (e.g., 'rust', 'python').",
      "additionalProperties": {
        "$ref": "#/definitions/server_config"
      }
    },
    "tools": {
      "type": "object",
      "description": "Tool-specific configuration.",
      "properties": {
        "run": {
          "$ref": "#/definitions/run_tool_config"
        }
      }
    }
  },
  "definitions": {
    "server_config": {
      "type": "object",
      "required": ["command"],
      "properties": {
        "command": {
          "type": "string",
          "description": "The command to execute (e.g., 'rust-analyzer', 'pyright-langserver')."
        },
        "args": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Arguments to pass to the command.",
          "default": []
        },
        "initialization_options": {
          "type": "object",
          "description": "Initialization options to pass to the LSP server during the 'initialize' request.",
          "additionalProperties": true
        }
      }
    },
    "run_tool_config": {
      "type": "object",
      "description": "Configuration for the 'run' shell execution tool.",
      "properties": {
        "allowed": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Always-allowed commands (e.g., ['git', 'make']). Use ['*'] for unrestricted execution.",
          "default": []
        },
        "denied": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Denied command+subcommand pairs (e.g., ['git grep', 'git log']). Takes priority over allowed, including ['*'].",
          "default": []
        }
      },
      "additionalProperties": {
        "$ref": "#/definitions/language_commands"
      }
    },
    "language_commands": {
      "type": "object",
      "description": "Language-specific allowed commands. Activated when matching files exist in workspace.",
      "properties": {
        "allowed": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Commands allowed for this language."
        }
      },
      "required": ["allowed"]
    }
  }
}
